(function(b,a){if(typeof define==="function"&&define.amd){define([],function(){return(b.Compress=a(b))})}else{if(typeof module==="object"&&typeof module.exports==="object"){module.exports=b.document?b.Compress=a(b):function(c){if(!c.document){throw new Error("Compress requires a document to run by default")}return b.Compress=a(c)}}else{b.document?b.Compress=a(b):(function(){throw new Error("Compress requires a document to run by default")})()}}})(typeof window!==undefined?window:this,function(e){var k=function(r,q){var o=Array.prototype.slice.call(arguments,1);if(!r){return console.log("the target object needed")}if(o.length<1){return console.log("at least one source object is needed")}for(var p=0;p<o.length;p++){var q=o[p];for(var s in q){if(q.hasOwnProperty(s)){r[s]=q[s]}}}return r};var c={change:function(o){this.files=Array.prototype.slice.call(o.target.files);if(this.option.changeFn){this.option.changeFn(o,this.files)}},drop:function(o){o.preventDefault();o.stopPropagation();this.files=Array.prototype.slice.call(o.dataTransfer.files);if(this.option.dropFn){this.option.dropFn(o,this.files)}},dragenter:function(o){o.preventDefault();console.log("drag entered")},dragover:function(o){o.preventDefault();console.log("drag entered")},dragleave:function(o){o.preventDefault();console.log("drag entered")}};var j=function(){var q=document.querySelectorAll(this.option.inputSelector)[0];for(var r in c){q.addEventListener(r,c[r].bind(this));if(this.option.dropSelector&&r!=="click"){document.querySelectorAll(this.option.dropSelector)[0].addEventListener(r,c[r].bind(this))}}if(this.option.rateSelector){var p=document.querySelectorAll(this.option.rateSelector)[0];p.addEventListener(this.option.rateEvent,this.option.rateFn.bind(this))}if(this.option.downloadSelector){var o=document.querySelectorAll(this.option.downloadSelector)[0];o.addEventListener("click",function(s){s.preventDefault();this.download()}.bind(this))}console.log(this)};function d(o){this.view();console.log("compressed file ")}function n(){document.querySelectorAll(this.option.imageSelector)[0].src=this.compSrc}function g(p){var o=p.target;this.option.rate=parseInt(o.value)}var i={inputSelector:"#input_cmprss",downloadSelector:"#comp_download",imageSelector:"#comp_img",changeFn:null,dropFn:null,dropSelector:null,rate:50,imagePrefix:"compressed-",dimen:null,compressFn:d,rateSelector:"#comp_rate",rateEvent:"change",rateFn:g};var b=function(o){var o=o||{};this.option=k({},i,o);j.call(this)};function m(p,o){this.compSrc=l.call(this,p,o);if(this.option.compressFn){this.option.compressFn.call(this,this.compSrc)}}function a(){var o=this.link||document.createElement("a");o.download=this.option.imagePrefix+this.files[0].name.replace(/\..+/,"");o.href=this.compSrc;o.click()}function l(u,s){var p=b.canvas;var q=p.getContext("2d");var t=new Image();t.src=u;var r,o;if(s){r=p.width=s.width;o=p.height=s.height}else{r=p.width=t.width;o=p.height=t.height}q.drawImage(t,0,0,r,o);return(p.toDataURL("image/jpeg",(this.option.rate/100)))}function h(){if(this.files&&/image\/.+/.test(this.files[0].type)){var o=new FileReader();o.onload=function(){m.call(this,o.result,this.option.dimen)}.bind(this);o.readAsDataURL(this.files[0])}else{console.error("an image must be selected and must be an image type")}}b.prototype={constructor:b,version:"v0.1",compress:h,download:a,view:n};var f=document.createElement("canvas");b.canvas=f;return b});