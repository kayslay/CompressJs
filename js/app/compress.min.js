(function(b,a){if(typeof define==="function"&&define.amd){define([],function(){return(b.Compress=a(b))})}else{if(typeof module==="object"&&typeof module.exports==="object"){module.exports=b.document?b.Compress=a(b):function(c){if(!c.document){throw new Error("Compress requires a document to run by default")}return b.Compress=a(c)}}else{b.document?b.Compress=a(b):(function(){throw new Error("Compress requires a document to run by default")})()}}})(typeof window!==undefined?window:this,function(e){var k=function(q,p){var n=Array.prototype.slice.call(arguments,1);if(!q){return console.log("the target object needed")}if(n.length<1){return console.log("at least one source object is needed")}for(var o=0;o<n.length;o++){var p=n[o];for(var r in p){if(p.hasOwnProperty(r)){q[r]=p[r]}}}return q};var c={change:function(n){this.files=Array.prototype.slice.call(n.target.files);if(this.option.changeFn){this.option.changeFn(n,this.files)}},drop:function(n){this.files=Array.prototype.slice.call(n.target.files);if(this.option.dropFn){this.option.dropFn(n,this.files)}}};var j=function(){var o=document.querySelectorAll(this.option.inputSelector)[0];for(var p in c){o.addEventListener(p,c[p].bind(this))}if(this.option.rateSelector){var n=document.querySelectorAll(this.option.rateSelector)[0];n.addEventListener(this.option.rateEvent,this.option.rateFn.bind(this))}console.log(this)};function d(n){console.log("compressed file ")}function g(o){var n=o.target;this.option.rate=parseInt(n.value)}var i={inputSelector:"#input_cmprss",downloadSelector:"#comp_download",imageSelector:"#comp_img",changeFn:null,dropFn:null,rate:20,imagePrefix:"compressed-",dimen:null,compressFn:d,rateSelector:"#comp_rate",rateEvent:"change",rateFn:g};var b=function(n){var n=n||{};this.option=k({},i,n);j.call(this)};function m(o,n){this.compSrc=l.call(this,o,n);if(this.option.compressFn){this.option.compressFn.call(this,this.compSrc)}}function a(){var n=this.link||document.createElement("a");n.download=this.option.imagePrefix+this.files[0].name.replace(/\..+/,"");n.href=this.compSrc;n.click()}function l(t,r){var o=b.canvas;var p=o.getContext("2d");var s=new Image();s.src=t;var q,n;if(r){q=o.width=r.width;n=o.height=r.height}else{q=o.width=s.width;n=o.height=s.height}p.drawImage(s,0,0,q,n);return(o.toDataURL("image/jpeg",(this.option.rate/100)))}function h(){if(this.files&&/image\/.+/.test(this.files[0].type)){var n=new FileReader();n.onload=function(){m.call(this,n.result,this.option.dimen)}.bind(this);n.readAsDataURL(this.files[0])}else{console.error("an image must be selected and must be an image type")}}b.prototype={constructor:b,version:"0.0.1",compress:h,download:a};var f=document.createElement("canvas");b.canvas=f;return b});